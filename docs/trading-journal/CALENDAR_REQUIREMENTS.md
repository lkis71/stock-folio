# 매매일지 캘린더 기능 요구사항 정의서

## 1. 기능 개요

### 1.1 목적
- 매매일지를 캘린더 형태로 시각화하여 월별 매매 패턴 파악
- 특정 날짜의 매매 활동을 빠르게 조회
- 수익/손실 추세를 직관적으로 확인

### 1.2 범위
- 월 단위 캘린더 뷰 제공
- 일별 매매 요약 정보 표시
- 상세 매매일지 연동

## 2. 기능 요구사항

### 2.1 필수 기능 (P0)

#### 2.1.1 캘린더 표시
- 월별 캘린더 그리드 표시 (7일 × 주 수)
- 이전/다음 달 이동 기능
- 오늘 날짜 강조 표시
- 매매가 있는 날짜 시각적 구분

#### 2.1.2 일별 매매 요약
- 각 날짜 셀에 표시:
  - 매매 건수 (거래 횟수)
  - 일일 손익 금액
  - 손익 상태 (수익/손실) 색상 표시

#### 2.1.3 날짜 선택 및 상세 조회
- 특정 날짜 탭 → 해당일 매매일지 목록 표시
- 시트(Sheet) 또는 네비게이션으로 상세 화면 이동
- 매매가 없는 날짜는 선택 불가 또는 "거래 없음" 표시

### 2.2 선택 기능 (P1)

#### 2.2.1 월별 통계
- 월 전체 손익 합계
- 월 총 매매 건수
- 승률 (수익 거래 / 전체 거래)

#### 2.2.2 필터링
- 특정 종목만 캘린더에 표시
- 포트폴리오별 필터링
- 수익/손실만 표시

#### 2.2.3 뷰 모드
- 캘린더 뷰 ↔ 리스트 뷰 전환
- 주간 뷰 지원 (선택 사항)

### 2.3 비기능 요구사항

#### 2.3.1 성능
- 월별 데이터 로드 시간: 1초 이내
- 부드러운 월 이동 애니메이션
- 대량 거래 기록 처리 (월 100건 이상)

#### 2.3.2 접근성
- VoiceOver 지원 (날짜 및 손익 정보 읽기)
- Dynamic Type 지원
- 다크 모드 대응

#### 2.3.3 사용성
- 컴팩트 디자인 원칙 준수
- 한 손으로 조작 가능한 인터랙션
- 직관적인 제스처 (스와이프로 월 이동)

## 3. 데이터 요구사항

### 3.1 필요한 데이터
```swift
// 일별 매매 요약
struct DailyTradingSummary {
    let date: Date                  // 날짜
    let tradeCount: Int             // 매매 건수
    let totalProfit: Decimal        // 일일 총 손익
    let profitRate: Decimal         // 일일 수익률
    let trades: [TradingRecord]     // 해당일 거래 목록
}

// 월별 통계
struct MonthlyStatistics {
    let month: DateComponents       // 연/월
    let totalProfit: Decimal        // 월 총 손익
    let totalTradeCount: Int        // 월 총 거래 건수
    let winRate: Decimal            // 승률
    let dailySummaries: [DailyTradingSummary]
}
```

### 3.2 데이터 조회
- SwiftData로 날짜 범위 기반 쿼리
- 매매일지(`TradingRecord`)에서 집계
- 월별로 캐싱하여 성능 최적화

## 4. 제약사항

### 4.1 기술적 제약
- iOS 17.0 이상
- SwiftData 사용
- SwiftUI 기반 UI

### 4.2 디자인 제약
- 컴팩트 디자인 원칙 준수
- 날짜 셀 최소 크기: 44pt (터치 영역)
- 캘린더 높이: 화면의 50% 이하

### 4.3 데이터 제약
- 매매일지 데이터 존재 필수
- 과거 데이터 무제한 조회 가능
- 미래 날짜 선택 불가

## 5. 우선순위

### Phase 1 (MVP)
- [P0] 월별 캘린더 표시
- [P0] 일별 매매 건수/손익 표시
- [P0] 날짜 탭 → 해당일 매매일지 조회
- [P0] 이전/다음 달 이동

### Phase 2
- [P1] 월별 통계 표시
- [P1] 캘린더 ↔ 리스트 뷰 전환
- [P1] 종목 필터링

### Phase 3
- [P1] 주간 뷰
- [P1] 승률 시각화
- [P2] 차트 연동 (손익 추이)

## 6. 기존 기능과의 통합

### 6.1 매매일지 목록 뷰와의 관계
- 캘린더 뷰: 월별 개요 파악용
- 리스트 뷰: 상세 조회 및 편집용
- 탭 또는 세그먼트로 뷰 전환

### 6.2 데이터 공유
- 동일한 `TradingRecord` 모델 사용
- `TradingJournalViewModel` 확장 또는 별도 ViewModel
- 날짜 필터링 로직 공유

### 6.3 화면 전환 흐름
```
TradingJournalView (탭바)
  ├─ 리스트 모드 (기본)
  └─ 캘린더 모드 (신규)
       └─ 날짜 선택
            └─ DailyTradesSheet (해당일 거래 목록)
                 └─ TradingJournalDetailView (거래 상세)
```

## 7. 성공 지표

- 캘린더 뷰 사용률: 전체 사용자의 30% 이상
- 날짜별 조회 평균 시간: 2초 이내
- 월 이동 조작 성공률: 95% 이상
- 사용자 만족도: 4.0/5.0 이상
